--- backup/factory\RepoFactoryMock.cls
+++ refactored/factory\RepoFactoryMock.cls
@@ -72 +71,0 @@
-IHistoryRepositoryrepo;
@@ -75 +74 @@
-List<FieldLevelHistory>historyRecords=HistoryResults.get(SObjectType);
+List<FieldLevelHistory>historyRecords=HistoryResults.get(sObjectType);
@@ -77,7 +76,9 @@
-if(
-queriedResults.size()>0||
-aggRecords?.size()>0||
-historyRecords?.size()>0||
-cursorResults?.size()>0||
-alwaysUseMock==true
-){
+BooleanuseMock=
+alwaysUseMock==true||
+!queriedResults.isEmpty()||
+(aggRecords!=null&&!aggRecords.isEmpty())||
+(historyRecords!=null&&!historyRecords.isEmpty())||
+(cursorResults!=null&&!cursorResults.isEmpty());
+if(!useMock){
+return(IHistoryRepository)fallback;
+}
@@ -92,5 +93 @@
-repo=mock;
-}else{
-repo=(IHistoryRepository)fallback;
-}
-returnrepo;
+returnmock;

--- backup/repository\AggregateRepository.cls
+++ refactored/repository\AggregateRepository.cls
@@ -138 +138,3 @@
-if(this.groupedByFieldNames.isEmpty()==false){
+if(this.groupedByFieldNames.isEmpty()){
+returnbaseString;
+}
@@ -155 +156,0 @@
-}

--- backup/repository\Cursor.cls
+++ refactored/repository\Cursor.cls
@@ -73,0 +74,3 @@
+if(possibleFetchSize<0){
+return0;
+}
@@ -83,3 +86 @@
-possibleFetchSize=maxRecordsPerFetchCall;
-}elseif(possibleFetchSize<0){
-possibleFetchSize=0;
+returnmaxRecordsPerFetchCall;

--- backup/repository\Query.cls
+++ refactored/repository\Query.cls
@@ -286 +286,2 @@
-}elseif(predicateinstanceofDatetime){
+}
+if(predicateinstanceofDatetime){
@@ -289 +290,2 @@
-}elseif(predicateinstanceofIterable<Object>){
+}
+if(predicateinstanceofIterable<Object>){
@@ -302 +304,2 @@
-}elseif(predicateinstanceofString){
+}
+if(predicateinstanceofString){